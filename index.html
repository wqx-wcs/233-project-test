<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>233ä¹å›­ - ç¤¾åŒºå‘ç°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            padding-bottom: 60px;
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 50px;
            background-color: #ff4e33;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 18px;
            font-weight: 500;
        }

        .tabs {
            position: fixed;
            top: 50px;
            left: 0;
            right: 0;
            height: 45px;
            background-color: white;
            display: flex;
            border-bottom: 1px solid #eee;
            z-index: 99;
        }

        .tab {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            color: #666;
            position: relative;
        }

        .tab.active {
            color: #ff4e33;
            font-weight: 500;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 25%;
            right: 25%;
            height: 3px;
            background-color: #ff4e33;
            border-radius: 3px;
        }

        .content {
            margin-top: 95px;
            padding: 10px;
            display: flex;
            justify-content: space-between;
        }

        .column {
            width: 49%;
        }

        .card {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 10px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .card-media {
            width: 100%;
            position: relative;
        }

        .card-media img {
            width: 100%;
            display: block;
        }

        .card-media video {
            width: 100%;
            display: block;
            background-color: #000;
        }

        .play-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .play-icon::after {
            content: '';
            width: 0;
            height: 0;
            border-top: 10px solid transparent;
            border-left: 15px solid white;
            border-bottom: 10px solid transparent;
            margin-left: 3px;
        }

        .card-content {
            padding: 10px;
        }

        .card-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 5px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-desc {
            font-size: 12px;
            color: #999;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-footer {
            display: flex;
            padding: 8px 10px;
            border-top: 1px solid #f0f0f0;
            font-size: 12px;
            color: #999;
        }

        .footer-item {
            display: flex;
            align-items: center;
            margin-right: 15px;
        }

        .footer-item i {
            margin-right: 3px;
            font-size: 14px;
        }

        .loading {
            text-align: center;
            padding: 15px;
            color: #999;
            font-size: 14px;
            display: none;
        }

        .refresh {
            text-align: center;
            padding: 15px;
            color: #999;
            font-size: 14px;
            position: absolute;
            top: -50px;
            left: 0;
            right: 0;
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>ç¤¾åŒºå‘ç°</h1>
    </div>

    <div class="tabs">
        <div class="tab active">å‘ç°</div>
        <div class="tab">æ¸¸æˆåœˆ</div>
        <div class="tab">æ¨¡æ‹Ÿæ ¡å›­</div>
    </div>

    <div class="content">
        <div class="column" id="column1"></div>
        <div class="column" id="column2"></div>
    </div>

    <div class="loading" id="loading">åŠ è½½ä¸­...</div>
    <div class="refresh" id="refresh">ä¸‹æ‹‰åˆ·æ–°</div>

    <script>
        /**
     * 233ä¹å›­ç¤¾åŒºå‘ç°é¡µ - ä¸»é€»è¾‘å®ç°
     * åŠŸèƒ½ï¼šç€‘å¸ƒæµå¸ƒå±€ã€ä¸Šæ‹‰åŠ è½½ã€ä¸‹æ‹‰åˆ·æ–°ã€è§†é¢‘æ’­æ”¾ã€æ•°æ®åŠ¨æ€æ¸²æŸ“
     */

        // é…ç½®å¸¸é‡
        const CONFIG = {
            DEFAULT_DATA_TYPE: 'default',
            LOAD_DELAY: 800,
            REFRESH_DELAY: 1000,
            VIDEO_PROBABILITY: 0.3,
            INITIAL_LOAD_COUNT: 12,
            SUBSEQUENT_LOAD_COUNT: 6
        };

        // æ•°æ®æ¨¡æ¿
        const DATA_TEMPLATES = {
            titles: {
                default: [
                    "ç‰ˆæœ¬å‰ç» | æ‰‹æ¸¸æ–°ç‰ˆæœ¬é¢„å‘Š",
                    "é‡ç½®æ–°æ¨¡å‹ éƒ¨åˆ†æ”»å‡»æ–°ç‰¹æ•ˆ",
                    "æ–°è§’è‰²æŠ€èƒ½å±•ç¤ºï¼Œå¤ªé…·å•¦ï¼",
                    "å…¬ä¼šæˆ˜æ–°ç©æ³•æ”»ç•¥åˆ†äº«",
                    "æ¯æ—¥ç­¾åˆ°å¥–åŠ±ç¿»å€æ´»åŠ¨å¼€å¯",
                    "ç©å®¶è‡ªåˆ¶åœ°å›¾åˆ†äº«"
                ],
                game: [
                    "ç‹è€…è£è€€æ–°èµ›å­£ä¸Šåˆ†æŠ€å·§",
                    "å’Œå¹³ç²¾è‹±æœ€æ–°æªæ¢°æµ‹è¯„",
                    "åŸç¥3.0ç‰ˆæœ¬æ–°åœ°å›¾æ¢ç´¢",
                    "LOLæ‰‹æ¸¸æ–°è‹±é›„æŠ€èƒ½è§£æ",
                    "é˜´é˜³å¸ˆæ–°å¼ç¥æŠ½å¡ç„å­¦",
                    "å´©å3æ–°å‰§æƒ…è®¨è®º"
                ],
                school: [
                    "æ ¡å›­æ¨¡æ‹Ÿæ–°æœè£…å±•ç¤º",
                    "åŒå­¦äº’åŠ¨æ–°åŠŸèƒ½ä½“éªŒ",
                    "æ•™å®¤è£…ä¿®è®¾è®¡å¤§èµ›",
                    "æ ¡å›­æ‹çˆ±å‰§æƒ…è®¨è®º",
                    "å­¦éœ¸å…»æˆæ”»ç•¥åˆ†äº«",
                    "æ ¡å›­æ´»åŠ¨ç­–åˆ’å»ºè®®"
                ]
            },
            descriptions: [
                "è¿™æ¬¡æ›´æ–°å¸¦æ¥äº†å…¨æ–°çš„æ¸¸æˆä½“éªŒï¼Œæ¨¡å‹æ›´åŠ ç²¾ç»†ï¼Œç‰¹æ•ˆæ›´åŠ ç‚«é…·ï¼Œå¿«æ¥ä½“éªŒå§ï¼",
                "ç»è¿‡ç©å®¶åé¦ˆï¼Œæˆ‘ä»¬å¯¹éƒ¨åˆ†è§’è‰²è¿›è¡Œäº†å¹³è¡¡æ€§è°ƒæ•´ï¼Œæ¸¸æˆä½“éªŒæ›´åŠ å…¬å¹³ã€‚",
                "æ–°ç‰ˆæœ¬æ´»åŠ¨ç¦åˆ©å¤šå¤šï¼Œç™»å½•å°±é€é™å®šçš®è‚¤ï¼Œåƒä¸‡ä¸è¦é”™è¿‡ï¼",
                "åˆ†äº«ä¸€ä¸ªå¿«é€Ÿå‡çº§çš„å°æŠ€å·§ï¼Œäº²æµ‹æœ‰æ•ˆï¼Œä¸€å¤©å‡10çº§ä¸æ˜¯æ¢¦ã€‚",
                "å…¬ä¼šæˆ˜æ–°ç©æ³•ä¸Šçº¿ï¼Œå›¢é˜Ÿé…åˆæ›´é‡è¦äº†ï¼Œæ¥çœ‹çœ‹æˆ‘ä»¬çš„æˆ˜æœ¯åˆ†äº«ã€‚",
                "ç©å®¶è‡ªåˆ¶åœ°å›¾ä¸Šçº¿åˆ›æ„å·¥åŠï¼Œå„ç§æœ‰è¶£ç©æ³•ç­‰ä½ æ¥å‘ç°ã€‚"
            ],
            users: ["æ¸¸æˆè¾¾äºº", "æ”»ç•¥å¤§å¸ˆ", "èŒæ–°ç©å®¶", "èµ„æ·±ç­–åˆ’", "ç”µç«é€‰æ‰‹", "ç¾æœ¯è®¾è®¡"]
        };

        // DOM å…ƒç´ 
        const DOM = {
            loading: document.getElementById('loading'),
            refresh: document.getElementById('refresh'),
            column1: document.getElementById('column1'),
            column2: document.getElementById('column2'),
            tabs: document.querySelectorAll('.tab')
        };

        /**
        * å·¥å…·å‡½æ•° - ä»URLè·å–å‚æ•°
        * @param {string} name - å‚æ•°å
        * @returns {string|null} å‚æ•°å€¼
        */
        function getUrlParam(name) {
            const params = new URLSearchParams(window.location.search);
            return params.get(name);
        }

        /**
        * ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
        * @param {string} type - æ•°æ®ç±»å‹ (default|game|school)
        * @returns {Array} ç”Ÿæˆçš„æ•°æ®æ•°ç»„
        */
        function generateMockData(type = CONFIG.DEFAULT_DATA_TYPE) {
            const data = [];
            const count = type === CONFIG.DEFAULT_DATA_TYPE ?
                CONFIG.INITIAL_LOAD_COUNT : CONFIG.SUBSEQUENT_LOAD_COUNT;
            const titles = DATA_TEMPLATES.titles[type] || DATA_TEMPLATES.titles.default;

            for (let i = 0; i < count; i++) {

                const isVideo = Math.random() < CONFIG.VIDEO_PROBABILITY;
                data.push({
                    id: Date.now() + i,
                    title: titles[i % titles.length],
                    description: DATA_TEMPLATES.descriptions[i % DATA_TEMPLATES.descriptions.length],
                    user: DATA_TEMPLATES.users[i % DATA_TEMPLATES.users.length],
                    likes: Math.floor(Math.random() * 1000),
                    comments: Math.floor(Math.random() * 500),
                    isVideo,
                    media: isVideo
                        ? `https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4?${type}`
                        : `https://picsum.photos/400/${Math.floor(300 + Math.random() * 200)}?random=${type}`
                });
            }

            return data;
        }

        /**
        * ç€‘å¸ƒæµå¸ƒå±€æ§åˆ¶å™¨
        */
        class WaterfallController {
            constructor() {
                this.columnHeights = [0, 0];
                this.page = 1;
                this.isLoading = false;
                this.dataType = getUrlParam('type') || CONFIG.DEFAULT_DATA_TYPE;
                this.startY = 0;
                this.currentY = 0;

                this.init();
            }

            /**
             * åˆå§‹åŒ–æ–¹æ³•
             */
            init() {
                this.setupEventListeners();
                this.loadData();
            }

            /**
             * è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
             */
            setupEventListeners() {
                // ä¸Šæ‹‰åŠ è½½
                window.addEventListener('scroll', this.handleScroll.bind(this));

                // ä¸‹æ‹‰åˆ·æ–°
                document.addEventListener('touchstart', this.handleTouchStart.bind(this), { passive: true });
                document.addEventListener('touchmove', this.handleTouchMove.bind(this), { passive: false });
                document.addEventListener('touchend', this.handleTouchEnd.bind(this), { passive: true });

                // è§†é¢‘æ§åˆ¶
                document.addEventListener('click', this.handleVideoControl.bind(this));

                // Tabåˆ‡æ¢
                DOM.tabs.forEach(tab => {
                    tab.addEventListener('click', () => this.switchTab(tab));
                });
            }

            /**
             * æ»šåŠ¨å¤„ç† - ä¸Šæ‹‰åŠ è½½
             */
            handleScroll() {
                if (this.isLoading) return;

                const { scrollTop, scrollHeight } = document.documentElement;
                const { innerHeight } = window;

                if (scrollTop + innerHeight >= scrollHeight - 100) {
                    this.loadData();
                }
            }

            /**
             * è§¦æ‘¸å¼€å§‹ - ä¸‹æ‹‰åˆ·æ–°
             * @param {TouchEvent} e 
             */
            handleTouchStart(e) {
                this.startY = e.touches[0].clientY;
            }

            /**
             * è§¦æ‘¸ç§»åŠ¨ - ä¸‹æ‹‰åˆ·æ–°
             * @param {TouchEvent} e 
             */
            handleTouchMove(e) {
                if (this.isLoading) return;

                this.currentY = e.touches[0].clientY;
                const diff = this.currentY - this.startY;

                if (diff > 0 && window.scrollY <= 0) {
                    e.preventDefault();
                    DOM.refresh.style.top = `${Math.min(diff, 60) - 50}px`;
                    DOM.refresh.textContent = diff > 60 ? 'é‡Šæ”¾åˆ·æ–°' : 'ä¸‹æ‹‰åˆ·æ–°';
                }
            }

            /**
             * è§¦æ‘¸ç»“æŸ - ä¸‹æ‹‰åˆ·æ–°
             */
            handleTouchEnd() {
                const diff = this.currentY - this.startY;

                if (diff > 60 && window.scrollY <= 0) {
                    this.refreshData();
                } else {
                    DOM.refresh.style.top = '-50px';
                }
            }

            /**
             * è§†é¢‘æ§åˆ¶å¤„ç†
             * @param {MouseEvent} e 
             */
            handleVideoControl(e) {
                // ç‚¹å‡»æ’­æ”¾æŒ‰é’®
                if (e.target.closest('.play-icon')) {
                    const video = e.target.closest('.card-media').querySelector('video');
                    if (video) {
                        video.play();
                        e.target.closest('.play-icon').style.display = 'none';
                    }
                    return;
                }

                // ç‚¹å‡»è§†é¢‘æš‚åœ
                if (e.target.tagName === 'VIDEO') {
                    const video = e.target;
                    video.pause();
                    video.currentTime = 0;
                    video.nextElementSibling.style.display = 'flex';
                }
            }

            /**
             * åˆ‡æ¢Tab
             * @param {HTMLElement} tab 
             */
            switchTab(tab) {
                DOM.tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                // æ ¹æ®Tabåˆ‡æ¢æ•°æ®ç±»å‹
                const typeMap = {
                    'å‘ç°': 'default',
                    'æ¸¸æˆåœˆ': 'game',
                    'æ¨¡æ‹Ÿæ ¡å›­': 'school'
                };

                this.dataType = typeMap[tab.textContent] || CONFIG.DEFAULT_DATA_TYPE;
                this.refreshData();
            }

            /**
             * åŠ è½½æ•°æ®
             */
            async loadData() {
                if (this.isLoading) return;

                this.isLoading = true;
                DOM.loading.style.display = 'block';

                // æ¨¡æ‹Ÿå¼‚æ­¥åŠ è½½
                await new Promise(resolve => setTimeout(resolve, CONFIG.LOAD_DELAY));

                const data = generateMockData(this.dataType);
                this.renderData(data);

                this.page++;
                this.isLoading = false;
                DOM.loading.style.display = 'none';
            }

            /**
             * åˆ·æ–°æ•°æ®
             */
            async refreshData() {
                DOM.refresh.textContent = 'åˆ·æ–°ä¸­...';

                // æ¸…ç©ºç°æœ‰å†…å®¹
                DOM.column1.innerHTML = '';
                DOM.column2.innerHTML = '';
                this.columnHeights = [0, 0];
                this.page = 1;

                // æ¨¡æ‹Ÿå¼‚æ­¥åˆ·æ–°
                await new Promise(resolve => setTimeout(resolve, CONFIG.REFRESH_DELAY));

                const data = generateMockData(this.dataType);
                this.renderData(data);

                DOM.refresh.style.top = '-50px';
                this.page = 2;
            }

            /**
             * æ¸²æŸ“æ•°æ®
             * @param {Array} data 
             */
            renderData(data) {
                data.forEach(item => {
                    const card = this.createCardElement(item);
                    const columnIndex = this.columnHeights[0] <= this.columnHeights[1] ? 0 : 1;

                    if (columnIndex === 0) {
                        DOM.column1.appendChild(card);
                    } else {
                        DOM.column2.appendChild(card);
                    }

                    this.columnHeights[columnIndex] += card.offsetHeight;
                });
            }

            /**
             * åˆ›å»ºå¡ç‰‡å…ƒç´ 
             * @param {Object} item 
             * @returns {HTMLElement} å¡ç‰‡å…ƒç´ 
             */
            createCardElement(item) {
                const card = document.createElement('div');
                card.className = 'card';

                const mediaHtml = item.isVideo ? `
          <div class="card-media">
          <video src="${item.media}" controls="" poster="https://picsum.photos/400/300?random=${item.id}>
          </video> 
          
          </div>
      ` : `
          <div class="card-media">
              <img src="${item.media}" alt="${item.title}" loading="lazy">
          </div>
      `;

                card.innerHTML = `
          ${mediaHtml}
          <div class="card-content">
              <div class="card-title">${item.title}</div>
              <div class="card-desc">${item.description}</div>
          </div>
          <div class="card-footer">
              <div class="footer-item">
                  <i>ğŸ‘¤</i>
                  <span>${item.user}</span>
              </div>
              <div class="footer-item">
                  <i>ğŸ‘</i>
                  <span>${item.likes}</span>
              </div>
              <div class="footer-item">
                  <i>ğŸ’¬</i>
                  <span>${item.comments}</span>
              </div>
          </div>
      `;

                return card;
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            new WaterfallController();
        });
    </script>
</body>

</html>